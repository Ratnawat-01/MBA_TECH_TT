<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Table Tennis Tournament</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 15px;
      background: #121212;
      color: #f5f5f5;
      text-align: center;
    }

```
h1 {
  color: #00ff90;
  font-size: 1.8rem;
  margin-bottom: 10px;
}

h2 {
  color: #fff;
  font-size: 1.3rem;
  margin-top: 30px;
  margin-bottom: 10px;
  border-bottom: 1px solid #00ff90;
  display: inline-block;
  padding-bottom: 5px;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
  font-size: 0.9rem;
}

th, td {
  border: 1px solid #444;
  padding: 8px;
  text-align: center;
}

th {
  background: #00ff90;
  color: #000;
  font-weight: bold;
}

tr:nth-child(even) {
  background: #1e1e1e;
}

input[type="number"] {
  width: 45px;
  background: #333;
  color: white;
  border: 1px solid #555;
  border-radius: 5px;
  text-align: center;
}

button {
  background-color: #00ff90;
  border: none;
  color: #000;
  padding: 10px 15px;
  font-weight: bold;
  border-radius: 25px;
  margin: 10px auto;
  cursor: pointer;
}

button:hover {
  background-color: #00cc70;
}

.match-section, .playoff-section, .finals-section {
  background: #1a1a1a;
  border-radius: 12px;
  padding: 10px;
  margin: 15px 0;
  box-shadow: 0px 0px 10px rgba(0,255,144,0.2);
}

.small-text {
  font-size: 0.8rem;
  color: #aaa;
}

@media (max-width: 600px) {
  table, th, td {
    font-size: 0.8rem;
  }
  input[type="number"] {
    width: 35px;
  }
}
```

  </style>
</head>
<body>
  <h1>Table Tennis Champions</h1>
  <div class="match-section">
    <h2>Round Robin Matches</h2>
    <table id="matchTable">
      <thead>
        <tr>
          <th>Player 1</th>
          <th>Player 2</th>
          <th>Score 1</th>
          <th>Score 2</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="updatePoints">Update Points</button>
  </div>

  <div class="match-section">
    <h2>Points Table</h2>
    <table id="pointsTable">
      <thead>
        <tr>
          <th>Pos</th>
          <th>Player</th>
          <th>Points</th>
          <th>Net Point Rate</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="playoff-section" id="playoffsSection" style="display:none;">
    <h2>Playoffs</h2>
    <div id="playoffs"></div>
  </div>

  <div class="finals-section" id="finalsSection" style="display:none;">
    <h2>Finals</h2>
    <div id="finals"></div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const selectedPlayers = JSON.parse(urlParams.get("players")) || [];

    const matchTableBody = document.querySelector("#matchTable tbody");
    const pointsTableBody = document.querySelector("#pointsTable tbody");
    const playoffsDiv = document.getElementById("playoffs");
    const finalsDiv = document.getElementById("finals");
    const playoffsSection = document.getElementById("playoffsSection");
    const finalsSection = document.getElementById("finalsSection");

    let matches = [];
    let points = {};

    selectedPlayers.forEach(p => {
      points[p] = { points: 0, scored: 0, conceded: 0, npr: 0 };
    });

    function generateFixtures(players) {
      let allMatches = [];
      for (let i = 0; i < players.length; i++) {
        for (let j = i + 1; j < players.length; j++) {
          allMatches.push([players[i], players[j]]);
        }
      }
      return allMatches.sort(() => Math.random() - 0.5);
    }

    matches = generateFixtures(selectedPlayers);

    matches.forEach(match => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${match[0]}</td>
        <td>${match[1]}</td>
        <td><input type="number" min="0" id="score_${match[0]}_${match[1]}_1"></td>
        <td><input type="number" min="0" id="score_${match[0]}_${match[1]}_2"></td>
      `;
      matchTableBody.appendChild(row);
    });

    document.getElementById("updatePoints").addEventListener("click", updatePointsTable);

    function updatePointsTable() {
      selectedPlayers.forEach(p => {
        points[p] = { points: 0, scored: 0, conceded: 0, npr: 0 };
      });

      matches.forEach(match => {
        const s1 = parseInt(document.getElementById(`score_${match[0]}_${match[1]}_1`).value || 0);
        const s2 = parseInt(document.getElementById(`score_${match[0]}_${match[1]}_2`).value || 0);
        if (s1 === 0 && s2 === 0) return;

        points[match[0]].scored += s1;
        points[match[0]].conceded += s2;
        points[match[1]].scored += s2;
        points[match[1]].conceded += s1;

        if (s1 > s2) points[match[0]].points += 2;
        else if (s2 > s1) points[match[1]].points += 2;
        else {
          points[match[0]].points += 1;
          points[match[1]].points += 1;
        }
      });

      selectedPlayers.forEach(p => {
        points[p].npr = points[p].scored - points[p].conceded;
      });

      const sorted = [...selectedPlayers].sort((a, b) => {
        if (points[b].points === points[a].points) return points[b].npr - points[a].npr;
        return points[b].points - points[a].points;
      });

      pointsTableBody.innerHTML = "";
      sorted.forEach((p, idx) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${idx + 1}</td><td>${p}</td><td>${points[p].points}</td><td>${points[p].npr}</td>`;
        pointsTableBody.appendChild(tr);
      });

      if (selectedPlayers.length > 5) generatePlayoffs(sorted);
      else generateFinals(sorted.slice(0, 2));
    }

    function generatePlayoffs(sorted) {
      playoffsSection.style.display = "block";
      finalsSection.style.display = "block";
      const [p1, p2, p3, p4] = sorted.slice(0, 4);
      playoffsDiv.innerHTML = `
        <h3>Qualifier 1: ${p1} vs ${p2}</h3>
        <h3>Eliminator: ${p3} vs ${p4}</h3>
        <h3>Qualifier 2: Loser(Q1) vs Winner(Eliminator)</h3>`;
      finalsDiv.innerHTML = `<h3>Finals: Winner(Q1) vs Winner(Q2)</h3>`;
    }

    function generateFinals(finalists) {
      playoffsSection.style.display = "none";
      finalsSection.style.display = "block";
      finalsDiv.innerHTML = `<h3>Finals: ${finalists[0]} vs ${finalists[1]}</h3>`;
    }
  </script>

</body>
</html>
